var v=Object.defineProperty;var O=(h,e,t)=>e in h?v(h,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):h[e]=t;var a=(h,e,t)=>(O(h,typeof e!="symbol"?e+"":e,t),t);import{W as y,S as L,P as D,C as X,V as Y,M as w,D as P,L as A,a as m,A as F,b as f,c as C,B as V,d as k,e as I,G as H,f as x,g as R,h as z,F as W,i as d,j as M}from"./vendor.js";const E=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const i of s)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&r(c)}).observe(document,{childList:!0,subtree:!0});function t(s){const i={};return s.integrity&&(i.integrity=s.integrity),s.referrerpolicy&&(i.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?i.credentials="include":s.crossorigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(s){if(s.ep)return;s.ep=!0;const i=t(s);fetch(s.href,i)}};E();class S{constructor(e=60,t=1.333,r=1,s=1e3){a(this,"aspectRatio");a(this,"fov");a(this,"znear");a(this,"zfar");a(this,"renderer");a(this,"scene");a(this,"camera");a(this,"clock");this.fov=e,this.aspectRatio=t,this.znear=r,this.zfar=s,this.renderer=new y,this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),this.resize(),window.addEventListener("resize",()=>{this.resize()},!1),window.addEventListener("mousedown",i=>{this.onMouseDown(i)}),window.addEventListener("mouseup",i=>{this.onMouseUp(i)}),window.addEventListener("mousemove",i=>{this.onMouseMove(i)}),window.addEventListener("wheel",i=>{this.onMouseWheel(i)}),window.addEventListener("keydown",i=>{this.onKeyDown(i)}),window.addEventListener("keyup",i=>{this.onKeyUp(i)}),this.scene=new L,this.camera=new D(this.fov,this.aspectRatio,this.znear,this.zfar),this.clock=new X}start(){this.createScene(),this.mainLoop()}mainLoop(){this.update(this.clock.getDelta()),this.renderer.render(this.scene,this.camera),window.requestAnimationFrame(()=>this.mainLoop())}resize(){this.renderer.setSize(window.innerWidth,window.innerHeight);var e=new Y;this.renderer.getViewport(e);var t=window.innerWidth/window.innerHeight;this.aspectRatio>t?this.renderer.setViewport(0,(window.innerHeight-window.innerWidth/this.aspectRatio)/2,window.innerWidth,window.innerWidth/this.aspectRatio):this.renderer.setViewport((window.innerWidth-window.innerHeight*this.aspectRatio)/2,0,window.innerHeight*this.aspectRatio,window.innerHeight)}onMouseDown(e){}onMouseUp(e){}onMouseMove(e){}onMouseWheel(e){}onKeyDown(e){}onKeyUp(e){}}class U extends S{constructor(){super(60,1920/1080,.1,10);a(this,"debugMode");a(this,"mouseDrag");a(this,"crushAlpha");a(this,"cameraOrbitX");a(this,"cameraOrbitY");a(this,"cameraDistance");a(this,"lightOrbitX");a(this,"lightOrbitY");a(this,"lightIntensity");a(this,"debugMaterial");a(this,"light");a(this,"lightHelper");a(this,"faceMesh");a(this,"sadFaceVertices");a(this,"happyFaceVertices");a(this,"faceAlpha");this.debugMode=!1,this.mouseDrag=!1,this.crushAlpha=0,this.cameraOrbitX=0,this.cameraOrbitY=0,this.cameraDistance=0,this.lightOrbitX=0,this.lightOrbitY=0,this.lightIntensity=0,this.debugMaterial=new w,this.light=new P,this.lightHelper=new A,this.faceMesh=new m,this.sadFaceVertices=[],this.happyFaceVertices=[],this.faceAlpha=0}createScene(){this.cameraDistance=3,this.camera.position.set(0,0,this.cameraDistance),this.camera.lookAt(0,0,0),this.camera.up.set(0,1,0);var e=new F("white",.15);this.scene.add(e),this.light.color=new f("white"),this.lightIntensity=.75,this.lightOrbitX=-22.5,this.lightOrbitY=45,this.scene.add(this.light);var t=[];t.push(new M(0,0,0)),t.push(new M(0,0,10)),this.lightHelper.geometry.setFromPoints(t),this.scene.add(this.lightHelper);var r=new C;r.color=new f("gray"),this.lightHelper.material=r,this.updateLightParameters();var s=new w;s.side=V,s.color.set("black");var i=new m(new k(1e3,1e3,1e3),s);this.scene.add(i),this.debugMaterial.wireframe=!0;var c=new I(2);this.scene.add(c);var b=new H,n=b.addFolder("Controls");n.open();var p=n.add(this,"faceAlpha",0,1);p.name("Face Alpha"),p.onChange(o=>{this.morphFace(o)});var u=n.add(this,"lightOrbitX",-180,180);u.name("Light Orbit X"),u.onChange(o=>{this.updateLightParameters()});var l=n.add(this,"lightOrbitY",-90,90);l.name("Light Orbit Y"),l.onChange(o=>{this.updateLightParameters()});var l=n.add(this,"lightIntensity",0,2);l.name("Light Intensity"),l.onChange(o=>{this.updateLightParameters()});var g=n.add(this,"debugMode");g.name("Debug Mode"),g.onChange(o=>{this.toggleDebugMode(o)}),this.faceMesh.material=new x,this.loadFaces()}loadFaces(){var e=new R;e.load("./assets/sad.ply",t=>{this.faceMesh.geometry=t,this.faceMesh.scale.set(.1,.1,.1),this.faceMesh.rotation.x=-Math.PI/2,this.scene.add(this.faceMesh);var r=t.getAttribute("position");this.sadFaceVertices=r.array}),e.load("./assets/happy.ply",t=>{var r=t.getAttribute("position");this.happyFaceVertices=r.array})}morphFace(e){var t=[];for(let r=0;r<this.sadFaceVertices.length;r++)t.push(z.lerp(this.sadFaceVertices[r],this.happyFaceVertices[r],e));this.faceMesh.geometry.setAttribute("position",new W(t,3))}update(e){}onMouseDown(e){e.target.localName=="canvas"&&(this.mouseDrag=!0)}onMouseUp(e){this.mouseDrag=!1}onMouseMove(e){this.mouseDrag&&(this.cameraOrbitX+=e.movementY,this.cameraOrbitX<90||this.cameraOrbitX>270?this.cameraOrbitY+=e.movementX:this.cameraOrbitY-=e.movementX,this.cameraOrbitX>=360?this.cameraOrbitX-=360:this.cameraOrbitX<0&&(this.cameraOrbitX+=360),this.cameraOrbitY>=360?this.cameraOrbitY-=360:this.cameraOrbitY<0&&(this.cameraOrbitY+=360),this.updateCameraOrbit())}onMouseWheel(e){this.cameraDistance+=e.deltaY/1e3,this.updateCameraOrbit()}updateCameraOrbit(){var e=new d().makeRotationY(-this.cameraOrbitY*Math.PI/180);e.multiply(new d().makeRotationX(-this.cameraOrbitX*Math.PI/180)),this.camera.position.set(0,0,this.cameraDistance),this.camera.applyMatrix4(e),this.cameraOrbitX<90||this.cameraOrbitX>270?this.camera.up.set(0,1,0):this.cameraOrbitX>90&&this.cameraOrbitX<270?this.camera.up.set(0,-1,0):this.cameraOrbitX==270?this.camera.up.set(Math.sin(-this.cameraOrbitY*Math.PI/180),0,Math.cos(-this.cameraOrbitY*Math.PI/180)):this.camera.up.set(-Math.sin(-this.cameraOrbitY*Math.PI/180),0,-Math.cos(-this.cameraOrbitY*Math.PI/180)),this.camera.lookAt(0,0,0)}updateLightParameters(){var e=new d().makeRotationY(this.lightOrbitX*Math.PI/180);e.multiply(new d().makeRotationX(-this.lightOrbitY*Math.PI/180)),this.light.position.set(0,0,10),this.light.applyMatrix4(e),this.lightHelper.lookAt(this.light.position),this.light.intensity=this.lightIntensity}toggleDebugMode(e){e?(this.faceMesh.userData={originalMaterial:this.faceMesh.material},this.faceMesh.material=this.debugMaterial):this.faceMesh.material=this.faceMesh.userData.originalMaterial,this.faceMesh.children.forEach(t=>{t instanceof m&&(e?(t.userData={originalMaterial:t.material},t.material=this.debugMaterial):t.material=t.userData.originalMaterial)})}}var B=new U;B.start();
