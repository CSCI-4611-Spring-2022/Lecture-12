var O=Object.defineProperty;var L=(h,e,a)=>e in h?O(h,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):h[e]=a;var i=(h,e,a)=>(L(h,typeof e!="symbol"?e+"":e,a),a);import{W as A,S as C,P as D,C as P,V as X,M as b,D as Y,L as V,a as M,b as d,c as p,A as k,d as H,B as I,e as x,f as R,G as N,g as z,h as F,i as u,F as y,j as m}from"./vendor.js";const W=function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const t of s)if(t.type==="childList")for(const n of t.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&r(n)}).observe(document,{childList:!0,subtree:!0});function a(s){const t={};return s.integrity&&(t.integrity=s.integrity),s.referrerpolicy&&(t.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?t.credentials="include":s.crossorigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function r(s){if(s.ep)return;s.ep=!0;const t=a(s);fetch(s.href,t)}};W();class E{constructor(e=60,a=1.333,r=1,s=1e3){i(this,"aspectRatio");i(this,"fov");i(this,"znear");i(this,"zfar");i(this,"renderer");i(this,"scene");i(this,"camera");i(this,"clock");this.fov=e,this.aspectRatio=a,this.znear=r,this.zfar=s,this.renderer=new A,this.renderer.setSize(window.innerWidth,window.innerHeight),document.body.appendChild(this.renderer.domElement),this.resize(),window.addEventListener("resize",()=>{this.resize()},!1),window.addEventListener("mousedown",t=>{this.onMouseDown(t)}),window.addEventListener("mouseup",t=>{this.onMouseUp(t)}),window.addEventListener("mousemove",t=>{this.onMouseMove(t)}),window.addEventListener("wheel",t=>{this.onMouseWheel(t)}),window.addEventListener("keydown",t=>{this.onKeyDown(t)}),window.addEventListener("keyup",t=>{this.onKeyUp(t)}),this.scene=new C,this.camera=new D(this.fov,this.aspectRatio,this.znear,this.zfar),this.clock=new P}start(){this.createScene(),this.mainLoop()}mainLoop(){this.update(this.clock.getDelta()),this.renderer.render(this.scene,this.camera),window.requestAnimationFrame(()=>this.mainLoop())}resize(){this.renderer.setSize(window.innerWidth,window.innerHeight);var e=new X;this.renderer.getViewport(e);var a=window.innerWidth/window.innerHeight;this.aspectRatio>a?this.renderer.setViewport(0,(window.innerHeight-window.innerWidth/this.aspectRatio)/2,window.innerWidth,window.innerWidth/this.aspectRatio):this.renderer.setViewport((window.innerWidth-window.innerHeight*this.aspectRatio)/2,0,window.innerHeight*this.aspectRatio,window.innerHeight)}onMouseDown(e){}onMouseUp(e){}onMouseMove(e){}onMouseWheel(e){}onKeyDown(e){}onKeyUp(e){}}class S extends E{constructor(){super(60,1920/1080,.1,10);i(this,"debugMode");i(this,"mouseDrag");i(this,"cameraOrbitX");i(this,"cameraOrbitY");i(this,"cameraDistance");i(this,"lightOrbitX");i(this,"lightOrbitY");i(this,"lightIntensity");i(this,"debugMaterial");i(this,"light");i(this,"lightHelper");i(this,"faceMesh");i(this,"sadVertices");i(this,"happyVertices");i(this,"sadNormals");i(this,"happyNormals");i(this,"sadColor");i(this,"happyColor");i(this,"sadPosition");i(this,"happyPosition");i(this,"faceAlpha");i(this,"morphDirection");this.debugMode=!1,this.mouseDrag=!1,this.cameraOrbitX=0,this.cameraOrbitY=0,this.cameraDistance=0,this.lightOrbitX=0,this.lightOrbitY=0,this.lightIntensity=0,this.debugMaterial=new b,this.light=new Y,this.lightHelper=new V,this.faceMesh=new M,this.sadVertices=[],this.happyVertices=[],this.sadNormals=[],this.happyNormals=[],this.sadColor=new d("blue"),this.happyColor=new d("orange"),this.sadPosition=new p(0,0,-1),this.happyPosition=new p(0,0,0),this.faceAlpha=0,this.morphDirection=1}createScene(){this.cameraDistance=1,this.camera.position.set(0,0,this.cameraDistance),this.camera.lookAt(0,0,0),this.camera.up.set(0,1,0);var e=new k("white",.15);this.scene.add(e),this.light.color=new d("white"),this.lightIntensity=.75,this.lightOrbitX=-22.5,this.lightOrbitY=45,this.scene.add(this.light);var a=[];a.push(new p(0,0,0)),a.push(new p(0,0,10)),this.lightHelper.geometry.setFromPoints(a),this.scene.add(this.lightHelper);var r=new H;r.color=new d("gray"),this.lightHelper.material=r,this.updateLightParameters();var s=new b;s.side=I,s.color.set("black");var t=new M(new x(1e3,1e3,1e3),s);this.scene.add(t),this.debugMaterial.wireframe=!0;var n=new R(2);this.scene.add(n);var v=new N,o=v.addFolder("Controls");o.open();var g=o.add(this,"faceAlpha",0,1);g.name("Face Alpha"),g.onChange(c=>{this.morphFace()});var w=o.add(this,"lightOrbitX",-180,180);w.name("Light Orbit X"),w.onChange(c=>{this.updateLightParameters()});var l=o.add(this,"lightOrbitY",-90,90);l.name("Light Orbit Y"),l.onChange(c=>{this.updateLightParameters()});var l=o.add(this,"lightIntensity",0,2);l.name("Light Intensity"),l.onChange(c=>{this.updateLightParameters()});var f=o.add(this,"debugMode");f.name("Debug Mode"),f.onChange(c=>{this.toggleDebugMode(c)}),this.loadFaces(),this.faceMesh.material=new z({color:this.sadColor}),this.faceMesh.scale.set(.035,.035,.035),this.faceMesh.position.copy(this.sadPosition),this.scene.add(this.faceMesh)}loadFaces(){var e=new F;e.load("./assets/sad.ply",a=>{this.faceMesh.geometry=a,this.sadVertices=a.getAttribute("position").array,this.sadNormals=a.getAttribute("normal").array}),e.load("./assets/happy.ply",a=>{this.happyVertices=a.getAttribute("position").array,this.happyNormals=a.getAttribute("normal").array})}morphFace(){var e=[],a=[];for(let t=0;t<this.sadVertices.length;t++)e.push(u.lerp(this.sadVertices[t],this.happyVertices[t],this.faceAlpha)),a.push(u.lerp(this.sadNormals[t],this.happyNormals[t],this.faceAlpha));this.faceMesh.geometry.setAttribute("position",new y(e,3)),this.faceMesh.geometry.setAttribute("normal",new y(a,3));var r=new d;r.lerpColors(this.sadColor,this.happyColor,this.faceAlpha),this.faceMesh.material.color=r;var s=new p;s.lerpVectors(this.sadPosition,this.happyPosition,this.faceAlpha),this.faceMesh.position.copy(s)}update(e){this.faceAlpha+=.5*e*this.morphDirection,(this.faceAlpha>1||this.faceAlpha<0)&&(this.faceAlpha=u.clamp(this.faceAlpha,0,1),this.morphDirection*=-1),this.morphFace()}onMouseDown(e){e.target.localName=="canvas"&&(this.mouseDrag=!0)}onMouseUp(e){this.mouseDrag=!1}onMouseMove(e){this.mouseDrag&&(this.cameraOrbitX+=e.movementY,this.cameraOrbitX<90||this.cameraOrbitX>270?this.cameraOrbitY+=e.movementX:this.cameraOrbitY-=e.movementX,this.cameraOrbitX>=360?this.cameraOrbitX-=360:this.cameraOrbitX<0&&(this.cameraOrbitX+=360),this.cameraOrbitY>=360?this.cameraOrbitY-=360:this.cameraOrbitY<0&&(this.cameraOrbitY+=360),this.updateCameraOrbit())}onMouseWheel(e){this.cameraDistance+=e.deltaY/1e3,this.updateCameraOrbit()}updateCameraOrbit(){var e=new m().makeRotationY(-this.cameraOrbitY*Math.PI/180);e.multiply(new m().makeRotationX(-this.cameraOrbitX*Math.PI/180)),this.camera.position.set(0,0,this.cameraDistance),this.camera.applyMatrix4(e),this.cameraOrbitX<90||this.cameraOrbitX>270?this.camera.up.set(0,1,0):this.cameraOrbitX>90&&this.cameraOrbitX<270?this.camera.up.set(0,-1,0):this.cameraOrbitX==270?this.camera.up.set(Math.sin(-this.cameraOrbitY*Math.PI/180),0,Math.cos(-this.cameraOrbitY*Math.PI/180)):this.camera.up.set(-Math.sin(-this.cameraOrbitY*Math.PI/180),0,-Math.cos(-this.cameraOrbitY*Math.PI/180)),this.camera.lookAt(0,0,0)}updateLightParameters(){var e=new m().makeRotationY(this.lightOrbitX*Math.PI/180);e.multiply(new m().makeRotationX(-this.lightOrbitY*Math.PI/180)),this.light.position.set(0,0,10),this.light.applyMatrix4(e),this.lightHelper.lookAt(this.light.position),this.light.intensity=this.lightIntensity}toggleDebugMode(e){e?(this.faceMesh.userData={originalMaterial:this.faceMesh.material},this.faceMesh.material=this.debugMaterial):this.faceMesh.material=this.faceMesh.userData.originalMaterial}}var U=new S;U.start();
